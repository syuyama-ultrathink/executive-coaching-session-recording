# 録音アプリケーション 要件定義書

作成日: 2025-11-17
バージョン: 1.0.0

## 1. 概要

### 1.1 目的
Windows/Mac対応のネイティブ録音アプリケーションを開発する。主にWeb会議の録音を目的とし、対面インタビューの録音にも対応する。

### 1.2 スコープ
- **プラットフォーム**: Windows 10/11、macOS 12以降
- **主要機能**: マイク入力とスピーカー出力の同時録音、ファイル管理
- **対象ユーザー**: Web会議参加者、インタビュアー

## 2. 機能要件

### 2.1 録音機能

#### 2.1.1 録音ソース
- **マイク入力録音**: ユーザーの音声をマイクから録音
- **スピーカー出力録音**: PCから再生される音声（システムオーディオ）を録音
- **同時録音**: マイクとスピーカーを同時に録音し、以下の3つのファイルを生成
  1. マイク音声のみ（例: `recording_mic.mp3`）
  2. スピーカー音声のみ（例: `recording_speaker.mp3`）
  3. マイク＋スピーカーのミックス（例: `recording_mixed.mp3`）

#### 2.1.2 音声品質設定
ユーザーが録音品質を選択可能にする：
- **標準品質**: 44.1kHz / 128kbps（ファイルサイズ小）
- **高品質**: 48kHz / 192kbps（バランス型）
- **最高品質**: 48kHz / 320kbps（音楽レベル品質）

#### 2.1.3 ファイル形式
- **出力形式**: MP3（圧縮形式）
- **チャンネル数**: ステレオ（2ch）

#### 2.1.4 録音制御
- **開始/停止**: 録音の開始と停止
- **一時停止/再開**: 録音中の一時停止と再開
- **ホットキー対応**: キーボードショートカットによる録音制御
  - 例: `Ctrl+Shift+R` で録音開始/停止
  - 例: `Ctrl+Shift+P` で一時停止/再開

#### 2.1.5 デバイス選択
- 複数のマイクデバイスから録音デバイスを選択
- 複数のスピーカーデバイスから録音デバイスを選択
- デバイスリストのリアルタイム更新（デバイス接続/切断時）

### 2.2 ユーザーインターフェース

#### 2.2.1 メインウィンドウ
- **録音ボタン**: 開始/停止/一時停止ボタン
- **レベルメーター**: マイクとスピーカーの音量をリアルタイム表示
  - マイクレベルメーター（緑→黄→赤のグラデーション）
  - スピーカーレベルメーター（緑→黄→赤のグラデーション）
- **録音時間表示**: 経過時間の表示（HH:MM:SS形式）
- **ファイル名入力**: 録音前にファイル名を指定
- **録音メモ入力**: 録音に関するメモを入力（メタデータとして保存）

#### 2.2.2 録音履歴画面
- 過去の録音ファイル一覧表示
  - ファイル名
  - 録音日時
  - 録音時間
  - ファイルサイズ
  - メモ内容
- **ファイル操作**:
  - 再生: アプリ内での音声再生
  - リネーム: ファイル名の変更
  - 論理削除: ファイルを「削除済み」としてマーク（UI上は非表示、実ファイルは削除しない）
  - ⚠️ **物理削除はUI上から禁止**: ファイルシステムからの完全削除はできない仕様

#### 2.2.3 設定画面
- **デフォルト保存先**: 録音ファイルの保存フォルダを指定
- **デフォルト品質**: 標準/高/最高から選択
- **ホットキー設定**: キーボードショートカットのカスタマイズ
- **クラウド連携設定**: Google Drive、Dropboxなどの連携設定

### 2.3 ファイル管理

#### 2.3.1 保存先
- **設定可能なデフォルト保存先**: ユーザーが設定で変更可能
- **デフォルトパス**:
  - Windows: `%USERPROFILE%\Documents\Recordings`
  - macOS: `~/Documents/Recordings`

#### 2.3.2 ファイル命名規則
- **デフォルト**: `YYYY-MM-DD_HHmmss_[ユーザー入力名].mp3`
- 例: `2025-11-17_143022_会議録音.mp3`

#### 2.3.3 メタデータ管理
録音ファイルと紐付けてメタデータをデータベースで管理：
- ファイル名
- 録音日時
- 録音時間
- メモ内容
- 論理削除フラグ
- ファイルパス

#### 2.3.4 クラウド連携
- **対応サービス**: Google Drive、Dropbox
- **自動アップロード**: 録音完了後に自動的にクラウドにアップロード
- **手動アップロード**: 履歴画面から個別にアップロード

### 2.4 音声再生機能
- アプリ内で録音ファイルを再生
- 再生コントロール: 再生/一時停止/停止/シーク
- 再生速度調整: 0.5x / 1.0x / 1.5x / 2.0x

### 2.5 バックグラウンド録音
- アプリウィンドウを最小化しても録音を継続
- システムトレイにアイコン表示
- トレイアイコンから録音状態を確認・制御可能

## 3. 非機能要件

### 3.1 パフォーマンス
- **最長録音時間**: 3時間以上
- **CPU使用率**: 録音中10%以下（アイドル時5%以下）
- **メモリ使用量**: 200MB以下
- **起動時間**: 3秒以内

### 3.2 互換性
- **Windows**: Windows 10（ビルド1809以降）、Windows 11
- **macOS**: macOS 12 Monterey以降
- **画面解像度**: 1280x720以上を推奨

### 3.3 セキュリティ・プライバシー
- **最小限のセキュリティ**: OS標準のセキュリティ機能に準拠
- **アクセス許可**: マイク・スピーカーへのアクセス許可をOSレベルで取得
- **データ保存**: ローカルストレージおよびユーザー指定のクラウドストレージ

### 3.4 信頼性
- **エラーハンドリング**: 録音失敗時のエラーメッセージ表示とリトライ機能
- **自動保存**: 録音中のクラッシュに備えた一時ファイル保存
- **デバイス切断対応**: 録音中にデバイスが切断された場合のエラー通知

### 3.5 ユーザビリティ
- **直感的なUI**: 初めてのユーザーでも迷わず使える設計
- **レスポンシブ**: ウィンドウサイズに応じたUI調整
- **多言語対応**: 日本語と英語をサポート（将来的に拡張可能）

## 4. システム構成

### 4.1 アプリケーション構成
```
録音アプリ
├── フロントエンド（UI）
│   ├── メイン画面
│   ├── 録音履歴画面
│   └── 設定画面
├── バックエンド（録音エンジン）
│   ├── 音声キャプチャモジュール
│   ├── エンコーディングモジュール
│   └── ファイル保存モジュール
├── データベース
│   └── メタデータ管理（SQLite）
└── クラウド連携モジュール
    ├── Google Drive API
    └── Dropbox API
```

### 4.2 データフロー
```
[マイク] ──┐
           ├─→ [音声キャプチャ] → [ミキサー] → [エンコーダ] → [ファイル保存]
[スピーカー] ┘                       ↓
                                 [レベルメーター]
```

### 4.3 ファイル構成
```
/
├── src/                    # ソースコード
│   ├── main/              # メインプロセス
│   ├── renderer/          # レンダラープロセス（UI）
│   ├── services/          # ビジネスロジック
│   └── utils/             # ユーティリティ
├── docs/                   # ドキュメント
│   └── requirements/      # 要件定義
├── tests/                  # テストコード
└── dist/                   # ビルド出力
```

## 5. データ設計

### 5.1 データベーススキーマ（SQLite）

#### recordings テーブル
| カラム名 | データ型 | 説明 |
|---------|---------|------|
| id | INTEGER PRIMARY KEY | レコードID |
| file_name | TEXT NOT NULL | ファイル名 |
| file_path | TEXT NOT NULL | ファイルパス |
| recorded_at | DATETIME NOT NULL | 録音日時 |
| duration | INTEGER NOT NULL | 録音時間（秒） |
| file_size | INTEGER | ファイルサイズ（バイト） |
| memo | TEXT | 録音メモ |
| quality | TEXT | 録音品質（standard/high/premium） |
| is_deleted | BOOLEAN DEFAULT 0 | 論理削除フラグ |
| created_at | DATETIME DEFAULT CURRENT_TIMESTAMP | 作成日時 |
| updated_at | DATETIME DEFAULT CURRENT_TIMESTAMP | 更新日時 |

#### settings テーブル
| カラム名 | データ型 | 説明 |
|---------|---------|------|
| key | TEXT PRIMARY KEY | 設定キー |
| value | TEXT | 設定値 |
| updated_at | DATETIME DEFAULT CURRENT_TIMESTAMP | 更新日時 |

## 6. 技術スタック候補

### 6.1 フレームワーク
- **Electron**: クロスプラットフォーム対応のデスクトップアプリフレームワーク
- **Tauri**: Rustベースの軽量代替案（検討中）

### 6.2 言語
- **TypeScript**: フロントエンド・バックエンド共通
- **Node.js**: バックエンドランタイム

### 6.3 UI
- **React**: UIライブラリ
- **Material-UI / Ant Design**: UIコンポーネントライブラリ

### 6.4 音声処理
- **node-record-lpcm16**: マイク録音
- **@ffmpeg/ffmpeg または fluent-ffmpeg**: MP3エンコーディング
- **Web Audio API**: レベルメーター表示

### 6.5 データベース
- **SQLite3 (better-sqlite3)**: ローカルデータベース

### 6.6 クラウドAPI
- **Google Drive API**: Google Drive連携
- **Dropbox API**: Dropbox連携

## 7. 開発フェーズ

### Phase 1: MVP（最小機能版）
- 基本的な録音機能（マイク＋スピーカー同時録音）
- 3ファイル生成（マイク、スピーカー、ミックス）
- シンプルなUI（録音ボタン、レベルメーター）
- ローカル保存のみ

### Phase 2: 履歴管理
- 録音履歴画面
- ファイル管理（再生、リネーム、論理削除）
- メタデータベース実装

### Phase 3: 高度な機能
- ホットキー対応
- デバイス選択
- バックグラウンド録音
- 設定画面

### Phase 4: クラウド連携
- Google Drive連携
- Dropbox連携
- 自動アップロード

## 8. テスト計画

### 8.1 単体テスト
- 音声キャプチャモジュールのテスト
- エンコーディングモジュールのテスト
- データベース操作のテスト

### 8.2 統合テスト
- 録音開始から保存までのエンドツーエンドテスト
- クラウドアップロードのテスト
- デバイス切り替えテスト

### 8.3 ユーザビリティテスト
- 実ユーザーによる使用感テスト
- UI/UXの改善フィードバック

## 9. リスクと対策

### 9.1 技術的リスク

#### リスク1: システムオーディオのキャプチャ
- **リスク内容**: Windows/macOSでスピーカー出力をキャプチャする方法が異なり、実装が複雑
- **対策**:
  - Windows: WASAPI（Windows Audio Session API）を使用
  - macOS: BlackHole等の仮想オーディオデバイスの使用を検討
  - 代替案: ユーザーに仮想オーディオデバイスのインストールを案内

#### リスク2: クロスプラットフォーム対応の複雑性
- **リスク内容**: Windows/macOSで音声APIが異なり、統一的な実装が困難
- **対策**: プラットフォーム固有のコードを抽象化し、共通インターフェースを提供

#### リスク3: パフォーマンス最適化
- **リスク内容**: 長時間録音時のメモリリークやCPU使用率の上昇
- **対策**: ストリーミング処理とバッファ管理の最適化、定期的なメモリ解放

### 9.2 スケジュールリスク
- **リスク内容**: クラウド連携の実装に時間がかかる可能性
- **対策**: Phase 4を独立させ、MVP（Phase 1-3）を優先リリース

## 10. 参考資料
- Electron公式ドキュメント: https://www.electronjs.org/
- Web Audio API: https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API
- Google Drive API: https://developers.google.com/drive
- Dropbox API: https://www.dropbox.com/developers

## 11. 承認
この要件定義書の内容で開発を進めて良いか確認してください。

---
**バージョン履歴**
- v1.0.0 (2025-11-17): 初版作成
