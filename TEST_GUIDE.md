# テスト確認ガイド - Phase 1

Phase 1（MVP）のテスト確認手順です。

## 📋 確認前のチェックリスト

### 必須環境
- ✅ Node.js 18.x以降がインストール済み
- ✅ npm 10.x以降がインストール済み
- ✅ 十分なディスク容量（約500MB）

### macOSの場合のみ
- BlackHoleのインストール（オプション、Phase 1では不要）

## 🚀 セットアップと起動手順

### ステップ1: プロジェクトフォルダに移動

```bash
cd "G:\共有ドライブ\CompanyDataSource_ExecutiveCoaching\200_Dev\001_RecordingApp"
```

### ステップ2: 依存関係のインストール

```bash
npm install
```

**所要時間**: 約3-5分

**期待される出力**:
- パッケージのダウンロードとインストール
- 最後に「added XXX packages」と表示

**エラーが出た場合**:
```bash
# キャッシュをクリアして再試行
npm cache clean --force
rm -rf node_modules package-lock.json
npm install
```

### ステップ3: Prismaのセットアップ

```bash
# Prisma Clientの生成
npm run prisma:generate
```

**期待される出力**:
- `✔ Generated Prisma Client`

```bash
# データベースマイグレーション
npm run prisma:migrate
```

**入力を求められたら**: マイグレーション名を `init` と入力してEnter

**期待される出力**:
- `prisma/recordings.db` ファイルが作成される
- マイグレーションが完了

### ステップ4: TypeScriptのビルド確認

```bash
npm run build:main
```

**期待される出力**:
- `dist/main/` フォルダが作成される
- エラーが出ないこと

### ステップ5: 開発サーバー起動

```bash
npm run dev
```

**期待される動作**:
1. Viteサーバーが起動（http://localhost:3000）
2. TypeScriptがコンパイルされる
3. Electronアプリが自動的に起動
4. DevToolsが自動で開く

**表示される画面**:
- ウィンドウタイトル: "Recording App"
- 中央に録音パネルが表示
- 録音時間カウンター: 00:00:00
- レベルメーター（マイク/スピーカー）
- 各種入力フィールドと設定

## ✅ 動作確認項目

### 1. UI表示確認

- [ ] アプリウィンドウが正常に表示される
- [ ] 録音時間が「00:00:00」で表示される
- [ ] レベルメーターが2つ（マイク/スピーカー）表示される
- [ ] 「録音開始」ボタンが表示される
- [ ] ファイル名入力欄が表示される
- [ ] メモ入力欄が表示される
- [ ] 音質選択ドロップダウンが表示される
- [ ] マイクデバイス選択が表示される
- [ ] スピーカーデバイス選択が表示される

### 2. 録音開始テスト

**手順**:
1. 「録音開始」ボタンをクリック

**期待される動作**:
- [ ] ボタンが「一時停止」と「録音停止」に変わる
- [ ] 録音時間カウンターが増加し始める（00:00:01, 00:00:02...）
- [ ] レベルメーターがランダムに動く（モックデータ）
- [ ] 「● 録音中」と赤文字で表示される
- [ ] 設定項目が無効化（グレーアウト）される

### 3. 一時停止テスト

**手順**:
1. 録音中に「一時停止」ボタンをクリック

**期待される動作**:
- [ ] ボタンが「再開」に変わる
- [ ] 録音時間カウンターが停止する
- [ ] レベルメーターの動きが止まる

**手順**:
2. 「再開」ボタンをクリック

**期待される動作**:
- [ ] ボタンが「一時停止」に戻る
- [ ] 録音時間カウンターが再開する
- [ ] レベルメーターが再び動き始める

### 4. 録音停止テスト

**手順**:
1. 録音中に「録音停止」ボタンをクリック

**期待される動作**:
- [ ] 「録音を保存しました (XX:XX:XX)」というメッセージが表示される
- [ ] ボタンが「録音開始」に戻る
- [ ] 録音時間カウンターが 00:00:00 にリセットされる
- [ ] レベルメーターが 0 になる
- [ ] 設定項目が再度有効になる
- [ ] ファイル名とメモがクリアされる

### 5. デバイス選択テスト

**手順**:
1. マイクデバイスのドロップダウンをクリック

**期待される動作**:
- [ ] 「Default Microphone」が表示される（Phase 1はモックデータ）

**手順**:
2. スピーカーデバイスのドロップダウンをクリック

**期待される動作**:
- [ ] 「Default Speaker」が表示される（Phase 1はモックデータ）

### 6. 音質選択テスト

**手順**:
1. 音質ドロップダウンをクリック

**期待される動作**:
- [ ] 3つの選択肢が表示される
  - 標準品質 (44.1kHz / 128kbps)
  - 高品質 (48kHz / 192kbps) ← デフォルト
  - 最高品質 (48kHz / 320kbps)
- [ ] 選択を変更できる
- [ ] 録音中は変更できない（無効化される）

### 7. データベース確認

**手順**:
1. 新しいターミナルを開く
2. プロジェクトフォルダで以下を実行

```bash
npx prisma studio
```

**期待される動作**:
- [ ] ブラウザで http://localhost:5555 が開く
- [ ] 左側に「Recording」「Setting」テーブルが表示される
- [ ] 録音停止後、Recordingテーブルにレコードが追加される

### 8. DevToolsでログ確認

**手順**:
1. DevToolsのConsoleタブを確認

**期待されるログ**:
```
Services initialized successfully
IPC: Start recording
IPC: Stop recording
```

**エラーがないこと**を確認

## 🐛 トラブルシューティング

### アプリが起動しない

**確認事項**:
1. `dist/main/index.js` が存在するか
   ```bash
   ls dist/main/
   ```

2. ポート3000が使用されていないか
   ```bash
   # Windows
   netstat -ano | findstr :3000

   # macOS/Linux
   lsof -i :3000
   ```

**解決方法**:
```bash
# ビルドを再実行
npm run build:main
npm run dev
```

### 「recordings.db」が作成されない

**解決方法**:
```bash
# Prismaを再セットアップ
rm -rf prisma/migrations
npx prisma generate
npx prisma migrate dev --name init
```

### TypeScriptエラーが出る

**確認事項**:
```bash
# 型チェック
npx tsc --noEmit
```

**解決方法**:
```bash
# node_modulesを再インストール
rm -rf node_modules package-lock.json
npm install
```

### レベルメーターが動かない

**Phase 1の仕様**: モックデータでランダムに動きます。実際の音声レベルではありません。

### 録音ファイルが作成されない

**Phase 1の仕様**: 実際のファイル保存はスタブ実装です。データベースにはメタデータのみ保存されます。

## ⚠️ Phase 1の制限事項

以下は**正常な動作**です（Phase 1.5以降で実装予定）:

1. **実際の音声録音は行われない**
   - AudioCaptureServiceはスタブ実装
   - 録音開始/停止のフローのみ確認

2. **MP3ファイルは作成されない**
   - EncodingServiceはスタブ実装
   - ファイルパスのみ生成

3. **レベルメーターはモックデータ**
   - 実際のマイク/スピーカーレベルは取得しない
   - ランダム値で表示

4. **デバイス一覧はモックデータ**
   - 実際のデバイスは検出しない
   - Default Microphone/Speakerのみ表示

## ✅ 成功の基準

以下がすべて確認できればPhase 1は成功です：

- [x] アプリが起動する
- [x] UIが正しく表示される
- [x] 録音開始/一時停止/停止のフローが動作する
- [x] 録音時間カウンターが動作する
- [x] レベルメーターが動作する（モック）
- [x] 設定項目の入力が可能
- [x] データベースにレコードが保存される
- [x] DevToolsでエラーが出ない

## 📝 次のステップ

Phase 1の動作確認が完了したら、次は**Phase 1.5: 実際の録音機能実装**に進みます。

1. AudioCaptureServiceの詳細実装
   - Windows: WASAPI loopback
   - macOS: BlackHole連携

2. EncodingServiceの詳細実装
   - FFmpegによるMP3エンコーディング
   - 音声ミキシング

3. FileServiceの詳細実装
   - 実際のファイル書き込み
   - 3ファイル生成（マイク/スピーカー/ミックス）

---

**作成日**: 2025-11-17
**Phase**: 1 (MVP - スタブ実装)
